import{r as _,j as i,a as u,M as h}from"./app-MQ-yEurC.js";import{R as f,D as g}from"./DashboardLayout-Q83-rxtQ.js";import{S as d}from"./sweetalert2.esm.all-DPJM2oV6.js";import{h as r}from"./moment-C5S46NFB.js";import{R as y}from"./ReactTable-CiiRreiS.js";import"./polyfill-CUJIp7Lq.js";import"./Dropdown-DtFVle0_.js";import"./transition-CQN9Mefa.js";import"./index-DzSybp8L.js";import"./index-FTPeQx5Q.js";setInterval(async()=>{let m=new Date,n=r(m),e=r(m),t=n.format("hh:mm:ss A"),s=e.format("LL");$("#timers").text(t),$("#timesdates").text(s)},800);class O extends _.Component{constructor(n){super(n),this.state={class_teaching:this.props.class_teaching,events:this.props.events,userdata:this.props.auth.user,requestimg:"/adminlte/dist/assets/img/avatar.png",timeCount:"00:00:00 AM",datenow:"00/00/000 Monday",profileImageBase64:"",lrn:"",idnumber:"",fullname:"",logger_type:"",logger_section:"",data:this.props.students,columns:[{id:"no",accessor:"no",Header:"No.",width:100,className:"center"},{id:"fullname",Header:"Fullname",width:200,className:"text-left",accessor:"fullname"},{id:"q1",Header:"Q1",className:"center",accessor:"id",Cell:({row:e})=>this.state.eq1==!0?i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]{3}",onKeyDown:t=>t.target.value.length<=3||t.target.value<=100,className:"center form-control border border-info",maxLength:3,max:100,min:0,id:`q1_${e.original.student_id}`,onBlur:()=>this.submitClassStudentGradeAttendanceSilence(e.original,"q1"),defaultValue:e.original.q1}):i.jsx("input",{type:"number",disabled:!0,className:"center form-control border border-info",maxLength:3,max:3,min:0,id:`q1_${e.original.student_id}`})},{id:"q2",Header:"Q2",className:"center",accessor:"id",Cell:({row:e})=>this.state.eq2==!0?i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]{3}",onKeyDown:t=>t.target.value.length<=3||t.target.value<=100,className:"center form-control border border-info",length:3,max:3,min:0,id:`q2_${e.original.student_id}`,onBlur:()=>this.submitClassStudentGradeAttendanceSilence(e.original,"q2"),defaultValue:e.original.q2}):i.jsx("input",{type:"number",disabled:!0,className:"center form-control border border-info",maxLength:3,max:3,min:0,id:`q1_${e.original.student_id}`})},{id:"q3",Header:"Q3",className:"center",accessor:"id",Cell:({row:e})=>this.state.eq3==!0?i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]{3}",onKeyDown:t=>t.target.value.length<=3||t.target.value<=100,className:"center form-control border border-info",length:3,max:3,min:0,id:`q3_${e.original.student_id}`,onBlur:()=>this.submitClassStudentGradeAttendanceSilence(e.original,"q3"),defaultValue:e.original.q3}):i.jsx("input",{type:"number",disabled:!0,className:"center form-control border border-info",maxLength:3,max:3,min:0,id:`q1_${e.original.student_id}`})},{id:"q4",Header:"Q4",className:"center",accessor:"id",Cell:({row:e})=>this.state.eq4==!0?i.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]{3}",onKeyDown:t=>t.target.value.length<=3||t.target.value<=100,className:"center form-control border border-info",length:3,max:3,min:0,id:`q4_${e.original.student_id}`,onBlur:()=>this.submitClassStudentGradeAttendanceSilence(e.original,"q4"),defaultValue:e.original.q4}):i.jsx("input",{type:"number",disabled:!0,className:"center form-control border border-info",maxLength:3,max:3,min:0,id:`q1_${e.original.student_id}`})}],time_logs_status:"",time_logs_status_message:"",attendance_data:[],attendance_data_temp:[],pagenationIndex:0,scanned_code:"",scan_paused:!1,start_scanning:!1,loading_subject_fetch:!1,scan_type:"class_attendance",subject_id:"",subject_name:"",classStudentList:[],assign_students:[],student_list:[],student_attendance:[],teaching_class:[],seats:[],table_row:4,table_column:8,loaded_data:!1,schedule_day:"",schedule_time:"",eq1:!0,eq2:!0,eq3:!0,eq4:!0},this.intervals=null,this.handleFocusableElements=!0,this.insertLogs=this.insertLogs.bind(this),this.loadStudentClass=this.loadStudentClass.bind(this),this.submitClassStudentGradeAttendanceSilence=this.submitClassStudentGradeAttendanceSilence.bind(this),this.timeoutScan=null,console.log(this.props)}componentDidMount(){window.addEventListener("keydown",this.eventKeys);let n=this.state.class_teaching.find(e=>e.id==this.state.class_teaching[0].id);this.setState({subject_id:this.state.class_teaching[0].id,subject_name:`${n.section_name} (${n.subject_name})`,start_scanning:!1,loading_subject_fetch:!0},()=>{this.loadStudentClass(this.state.class_teaching[0].id)})}async eventKeys(n,e){let t=this,s=n.key;try{if(t.timeoutScan!=null){t.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Please Try Again"});return}else t.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"",time_logs_status_message:""});if(s=="Enter"&&t.state.scanned_code!="Enter"&&t.state.scanned_code.trim()!=="")console.log(t.state.scanned_code," - aw"),t.timeoutScan=setTimeout(()=>{clearTimeout(t.timeoutScan),t.timeoutScan=null},2e3),t.queryAccounts(t.state.scanned_code),t.setState({scanned_code:""});else{let a=t.state.scanned_code+s;s==="Enter"?t.setState({scanned_code_history:"",scanned_code:""}):t.setState({scanned_code_history:a,scanned_code:a})}}catch{}}eventKeys2(n){let e=this,t=n;try{if(e.timeoutScan!=null){e.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Please Try Again"});return}else e.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"",time_logs_status_message:""});if(t.trim()!=="")e.setState({scanned_code:t,scanned_code_history:t,scan_paused:!0},()=>{e.timeoutScan=setTimeout(()=>{clearTimeout(e.timeoutScan),e.timeoutScan=null,e.setState({scan_paused:!1})},5e3),e.queryAccounts(t),e.setState({scanned_code:""})});else{let s=e.state.scanned_code+t;t==="Enter"?e.setState({scanned_code_history:"",scanned_code:""}):e.setState({scanned_code_history:s,scanned_code:s})}}catch{}}getTimeLogs(n){let e=r(new Date).format("YYYY-MM-DD");u.post("/attendance/time/logs",{qrcode:n,date:e}).then(function(t){console.log(t),typeof t.status<"u"&&t.status=="200"&&(typeof t.data<"u"&&typeof t.data.data<"u"&&t.data.data,typeof t.data<"u"&&t.data.status=="success")})}getAllTodaysTimeLogs(){let n=this,e=r(new Date).format("YYYY-MM-DD");n.state.teaching_class.length>0&&u.post("/attendance/time/today/class/timelogs",{date:e,terminal_id:`class_id_${n.state.teaching_class[0].class_id}_teacher_id_${n.state.teaching_class[0].teacher_id}`,id:n.state.teaching_class[0].id,teacher_id:n.state.teaching_class[0].teacher_id,class_id:n.state.teaching_class[0].class_id}).then(function(t){if(typeof t.status<"u"&&t.status=="200"){let s=typeof t.data<"u"&&typeof t.data.data<"u"?t.data.data:[];typeof t.data<"u"&&t.data.status=="success"&&(n.setState({attendance_data:s},()=>{}),s.length>0&&s.forEach(a=>{let l=n.state.seats,c=[];l.length>0&&l.some(o=>o.lrn==a.lrn)&&(c=l.map(o=>o.lrn===a.lrn?(a.mode=="present"?$(`.seat_${o.seat_number}`).addClass("student_chair_present"):$(`.seat_${o.seat_number}`).addClass("student_chair_absent"),{...o,status:a.mode}):{...o,status:"absent"}),n.setState({student_attendance:c}))}))}})}insertLogs(n,e,t){let s=this;delete e.picture_base64,u.post("/attendance/time/new/entry/by/class",{logsdata:n,userdata:e}).then(function(a){if(console.log(a),typeof a.status<"u"&&a.status=="200"){let l=typeof a.data<"u"&&typeof a.data.data<"u"?a.data.data:{};typeof a.data<"u"&&a.data.status=="success"?(console.log("aw",l),t(),s.getAllTodaysTimeLogs(),s.alertMessages()):typeof a.data<"u"&&a.data.status=="not_found"&&(s.AlertSound.denied(),s.alertMessages(),s.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Not Found"}),t())}else s.AlertSound.denied(),s.alertMessages(),s.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Sorry Please Try Again"}),t()}).catch(function(a){console.log(a),t()}).finally(function(){t()})}alertMessages(){let n=this,e=5e3;this.intervals!=null&&(clearTimeout(this.intervals),this.intervals=null),this.intervals=setTimeout(()=>{n.setState({lrn:"",profileImageBase64:"",requestimg:"",fullname:"",idnumber:"",logger_type:"",logger_section:"",time_logs_status:"",time_logs_status_message:""},()=>{clearTimeout(this.intervals),this.intervals=null})},e)}loadStudentClass(n){let e=this;r(new Date).format("YYYY-MM-DD"),u.post("/attendance/class/students",{id:n}).then(function(t){if(typeof t.status<"u"&&t.status=="201"){let s=typeof t.data<"u"&&typeof t.data.data<"u"?t.data.data:{};if(typeof t.data<"u"&&t.data.status=="success"){let a=[];s.class_teaching.length>0&&(s.class_teaching[0].monday=="1"&&a.push("Mon"),s.class_teaching[0].tuesday=="1"&&a.push("Tue"),s.class_teaching[0].wednesday=="1"&&a.push("Wed"),s.class_teaching[0].thursday=="1"&&a.push("Thu"),s.class_teaching[0].friday=="1"&&a.push("Fri"),s.class_teaching[0].saturday=="1"&&a.push("Sat")),e.setState({schedule_day:a.length>0?a.toString().replaceAll(","," - "):"",teaching_class:s.class_teaching,table_row:Number(s.classrooms_seats[0].number_rows),table_column:Number(s.classrooms_seats[0].number_columns),classStudentList:s.student,seats:s.classrooms_seats_assign,assign_students:s.classrooms_seats_assign,start_scanning:!0,loading_subject_fetch:!1},()=>{e.assignedStudentList()})}}})}assignedStudentList(){let n=this,e=[];this.state.assign_students.length>0&&this.state.assign_students.forEach((t,s,a)=>{if(n.state.classStudentList.some(l=>l.student_id===Number(t.student_id))===!0){let l=n.state.classStudentList.find(c=>c.student_id==t.student_id);e.push({...t,...l,seat_number:Number(t.seat_number)})}s+1==a.length&&n.setState({seats:e,loaded_data:!0})})}submitClassAttendance(){let n=this;if(n.state.student_attendance.length==n.state.seats.length){let e=r(new Date).format("YYYY-MM-DD");d.fire({title:"If all fields are correct and please click to continue to save",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"warning",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(async t=>{if(t.isConfirmed){d.fire({title:`Saving Records.
Please wait.`,html:'<i class="fa fa-times-circle-o"></i>&nbsp;&nbsp;Close',showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{d.showLoading()}});let s={id:n.state.teaching_class[0].id,teacher_id:n.state.teaching_class[0].teacher_id,class_id:n.state.teaching_class[0].class_id,class_subject:n.state.teaching_class.length>0?n.state.teaching_class[0].subject_name:"",date:e,time:r(new Date).format("hh:mm A"),mode:"IN",type:"student",student_attendance:n.state.student_attendance};u.post("/attendance/time/new/entry/by/class",s).then(async function(a){console.log(a),typeof a.status<"u"&&a.status=="200"?(typeof a.data<"u"&&typeof a.data<"u"?a.data:{}).status=="success"?d.fire({title:"Successfuly save!",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"success",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(function(c){c.isConfirmed&&(d.close(),$("#teacher").val(""),$("#time_start").val(""))}):d.fire({title:"Fail to save",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!1,closeOnClickOutside:!1,dangerMode:!0}):typeof a.status<"u"&&a.status=="200"?(typeof a.data<"u"&&typeof a.data<"u"?a.data:{}).status=="data_exist"&&d.fire({title:"Data Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}):typeof a.status<"u"&&a.status=="422"}).catch(function(a){d.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})}else t.isDismissed;return!1})}else d.fire({title:"Please complete to check all student",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})}setAttendance(n,e){let t=this,s=this.state.student_attendance,a=[];s.length>0&&s.some(l=>l.student_id==e.student_id)?(a=s.map(l=>l.student_id===e.student_id?{...l,status:n,val:e}:l),t.setState({student_attendance:a})):(s.push({...e,status:n}),t.setState({student_attendance:s}))}submitClassStudentGradeAttendanceSilence(n,e){let t=this,s=$(`#${e}_${n.id}`).val();if(s!=""){let a={id:t.state.teaching_class[0].id,teacher_id:Number(t.state.teaching_class[0].teacher_id),teacher_name:t.state.class_teaching.length>0?t.state.class_teaching[0].teacher_name:"",class_id:t.state.teaching_class[0].class_id,class_subject:t.state.teaching_class.length>0?t.state.teaching_class[0].subject_name:"",class_subject_id:t.state.teaching_class.length>0?t.state.teaching_class[0].subject_id:"",student_id:n.student_id,grade:t.state.class_teaching.length>0?t.state.class_teaching[0].grade:"",sy:t.state.class_teaching.length>0?t.state.class_teaching[0].school_year:"",q:e,final_grade:s};u.post("/class/subject/ginal/grade/update",a).then(async function(l){typeof l.status<"u"&&l.status=="201"?(typeof l.data<"u"&&typeof l.data<"u"?l.data:{}).status=="success"?f.success("Save","Successfuly Update!"):f.error("Save","Something wrong!. Unable to save."):typeof l.status<"u"&&l.status=="200"?(typeof l.data<"u"&&typeof l.data<"u"?l.data:{}).status=="data_exist"&&d.fire({title:"Data Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}):typeof l.status<"u"&&l.status=="422"}).catch(function(l){d.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})}else{console.log("no value",s,n,e);return}}render(){return i.jsx(g,{title:"Student",user:this.props.auth.user,profile:this.props.auth.profile,children:i.jsxs("div",{className:"noselect",children:[i.jsx(h,{title:"Attendance"}),i.jsx("div",{className:"mx-auto",children:this.state.start_scanning==!0?i.jsx("div",{className:""}):i.jsx("div",{className:"log-center-data-mobile",children:i.jsx("div",{className:"row",children:this.state.loading_subject_fetch==!0?i.jsx("div",{className:"col-lg-12 center mt-5",children:i.jsx("div",{className:"spinner-border text-primary",role:"status",children:i.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):null})})}),i.jsx("div",{className:"app-content",children:i.jsx("div",{className:"container-fluid",children:this.state.loaded_data==!0?i.jsxs("div",{className:"mx-auto mt-5",children:[i.jsxs("div",{className:"row",children:[i.jsx("div",{className:"col-sm-6",children:i.jsxs("h3",{className:"mb-0",children:[i.jsx("i",{className:"nav-icon bi bi-bookmark"})," Subject: ",i.jsx("strong",{className:"badge bg bg-primary",children:this.state.teaching_class.length>0?this.state.teaching_class[0].subject_name:""})]})}),i.jsx("div",{className:"col-sm-6",children:i.jsx("ol",{className:"breadcrumb float-sm-end",children:i.jsxs("li",{className:"breadcrumb-item active",children:["Schedule: ",i.jsx("div",{className:"badge bg-primary",children:this.state.schedule_day}),i.jsx("div",{className:"badge bg-primary",children:this.state.teaching_class.length>0?this.state.teaching_class[0].time_start+" - "+this.state.teaching_class[0].time_end:""})]})})})]}),i.jsx("div",{className:"container text-center",children:i.jsx(y,{className:"table table-bordered table-striped ",data:this.state.data,columns:this.state.columns,showHeader:!0,showPagenation:!0,defaultPageSize:20},"react-tables")})]}):i.jsx(i.Fragment,{})})})]})})}}export{O as default};
