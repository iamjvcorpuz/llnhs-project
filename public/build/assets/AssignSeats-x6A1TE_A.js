import{r as h,a as m,j as s,U as u}from"./app-MQ-yEurC.js";import{E as f}from"./EachMethod-DlQbtg5B.js";import{S as c}from"./sweetalert2.esm.all-DPJM2oV6.js";import"./moment-C5S46NFB.js";import"./index-B9Tcu3qw.js";import"./react-webcam-C_JsNYoc.js";import"./apexcharts.esm-CWma0ncG.js";import"./index-FTPeQx5Q.js";import{D as _}from"./DashboardLayout-Q83-rxtQ.js";import"./Dropdown-DtFVle0_.js";import"./transition-CQN9Mefa.js";import"./index-DzSybp8L.js";class k extends h.Component{constructor(t){super(t),this.state={id:typeof this.props.class_teaching<"u"&&this.props.class_teaching.length>0?this.props.class_teaching[0].id:"",class_id:typeof this.props.class_teaching<"u"&&this.props.class_teaching.length>0?this.props.class_teaching[0].class_id:"",subject_id:typeof this.props.class_teaching<"u"&&this.props.class_teaching.length>0?this.props.class_teaching[0].subject_id:"",table_row:typeof this.props.assign_class_teaching<"u"&&this.props.assign_class_teaching.length>0?Number(this.props.assign_class_teaching[0].number_rows):6,table_column:typeof this.props.assign_class_teaching<"u"&&this.props.assign_class_teaching.length>0?Number(this.props.assign_class_teaching[0].number_columns):6,table_count:0,seats:[],studentsListTemp:typeof this.props.students<"u"&&this.props.students.length>0?this.props.students:[],studentsList:[],class_assign_seats:[],studentselection:"",selectSeat:0,existing_class_id:"",existing_class:typeof this.props.assign_class_seats<"u"&&this.props.assign_class_seats.length>0?this.props.assign_class_seats:[],existing_class_assigned:typeof this.props.assign_class_seats_assigned<"u"&&this.props.assign_class_seats_assigned.length>0?this.props.assign_class_seats_assigned:[]},console.log(this.props),this.saveData=this.saveData.bind(this),this.addStudent=this.addStudent.bind(this),this.loadExistingData=this.loadExistingData.bind(this),this.loadExistingAssignedData=this.loadExistingAssignedData.bind(this)}componentDidMount(){this.studentList(),this.assignedStudentList()}loadExistingData(){let t=this;this.setState({existing_class_id:typeof this.state.existing_class<"u"&&this.state.existing_class.length>0?this.state.existing_class[0].class_teaching_id:6,table_row:typeof this.state.existing_class<"u"&&this.state.existing_class.length>0?this.state.existing_class[0].number_rows:6,table_column:typeof this.state.existing_class<"u"&&this.state.existing_class.length>0?this.state.existing_class[0].number_columns:6},()=>{$("#seat_row").val(t.state.table_row),$("#seat_column").val(t.state.table_column),c.fire({title:"Do you want to also use existing assigned seats?",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Yes",icon:"warning",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(async e=>{t.loadExistingAssignedData()})})}loadExistingAssignedData(){let t=this,e=[];this.state.existing_class_assigned.length>0&&this.state.existing_class_assigned.forEach((a,d,l)=>{if(t.state.studentsListTemp.some(n=>Number(n.student_id)===Number(a.student_id))===!0&&a.classrooms_seats_id===t.state.existing_class_id){let n=t.state.studentsListTemp.find(i=>i.student_id==a.student_id);e.push({...a,...n,seat_number:Number(a.seat_number)})}d+1==l.length&&t.setState({seats:e})})}studentList(){let t=this,e=[];this.state.studentsListTemp.forEach((a,d,l)=>{t.state.seats.length>0&&t.state.seats.some(n=>n.student_id==a.student_id)===!1&&e.push({...a}),d+1==l.length&&(t.setState({studentsList:e}),e.length===0&&t.setState({studentsList:t.state.studentsListTemp}))})}assignedStudentList(){let t=this,e=[];this.props.assign_students.length>0&&this.props.assign_students.forEach((a,d,l)=>{if(t.state.studentsListTemp.some(n=>n.student_id===Number(a.student_id))===!0){let n=t.state.studentsListTemp.find(i=>i.student_id==a.student_id);e.push({...a,...n,seat_number:Number(a.seat_number)})}d+1==l.length&&(t.setState({seats:e}),t.studentList())})}saveData(){let t=this,e=$("#seat_row").val(),a=$("#seat_column").val(),d=this.state.seats;a!=""&&e!=""?c.fire({title:"If all fields are correct and please click to continue to save",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"warning",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(async l=>{if(l.isConfirmed){c.fire({title:`Saving Records.
Please wait.`,html:'<i class="fa fa-times-circle-o"></i>&nbsp;&nbsp;Close',showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{c.showLoading()}});let n={id:t.state.id,subject_id:t.state.subject_id,class_id:t.state.class_id,number_rows:e,number_columns:a,seats:d,total_students:[]};m.post("/classroom/seating/update",n).then(async function(i){typeof i.status<"u"&&i.status=="201"?(typeof i.data<"u"&&typeof i.data<"u"?i.data:{}).status=="success"?c.fire({title:"Successfuly save!",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"success",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(function(r){r.isConfirmed&&(c.close(),$("#teacher").val(""),$("#time_start").val(""))}):c.fire({title:"Fail to save",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!1,closeOnClickOutside:!1,dangerMode:!0}):typeof i.status<"u"&&i.status=="200"?(typeof i.data<"u"&&typeof i.data<"u"?i.data:{}).status=="data_exist"&&c.fire({title:"Data Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}):typeof i.status<"u"&&i.status=="422"}).catch(function(i){c.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})}else l.isDismissed;return!1}):d.length==0?c.fire({title:"No assigned seats",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Close",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}):(e==""&&($("#seat_row-alert").removeAttr("class"),$("#seat_row-alert").html("Required Field"),$("#seat_row-alert").addClass("d-block invalid-feedback")),a==""&&($("#seat_column-alert").removeAttr("class"),$("#seat_column-alert").html("Required Field"),$("#seat_column-alert").addClass("d-block invalid-feedback")))}addStudent(){let t=this,e=this.state.seats,a=$("#studentselection").val();if(t.state.studentsListTemp.length>0){if(a!=""){t.state.studentsList.find(l=>`${l.last_name}, ${l.first_name}`==a).id;let d=t.state.studentsList.find(l=>`${l.last_name}, ${l.first_name}`==a);e.push({seat_number:Number(t.state.selectSeat),...d}),t.setState({seats:e},()=>{t.studentList()}),$("#studentModel").modal("hide"),$("#studentselection").val("")}}else c.fire({title:"No Student Added",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Close",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})}removeStudent(t){let e=this,a=this.state.seats,d=[];e.state.selectSeat!=0&&a.length>0&&a.forEach((l,n,i)=>{l.seat_number!==Number(e.state.selectSeat)&&d.push({...l}),n+1==i.length&&e.setState({seats:d},()=>{e.studentList()})})}render(){return s.jsx(_,{title:"Student",user:this.props.auth.user,children:s.jsxs("div",{className:"noselect",children:[s.jsx("div",{className:"app-content-header",children:s.jsx("div",{className:"container-fluid",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-sm-6",children:s.jsxs("h3",{className:"mb-0",children:[s.jsx("i",{className:"nav-icon bi bi-person-lines-fill"})," Class Seat"]})}),s.jsx("div",{className:"col-sm-6",children:s.jsxs("ol",{className:"breadcrumb float-sm-end",children:[s.jsx("li",{className:"breadcrumb-item",children:s.jsx(u,{href:"/admin/dashboard",children:"Dashboard"})}),s.jsx("li",{className:"breadcrumb-item",children:s.jsx(u,{href:"/teacher/class/subject",children:"Class Subjects"})}),s.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:"Class Seat"})]})})]})})}),s.jsx("div",{className:"app-content",children:s.jsxs("div",{className:"container-fluid",children:[s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-md-2",children:[s.jsx("label",{htmlFor:"seat_row",className:"form-label",children:"Seat Rows"}),s.jsx("input",{type:"number",min:0,max:10,className:"form-control text-center",id:"seat_row",defaultValue:this.state.table_row,onChange:t=>this.setState({table_row:t.target.value})}),s.jsx("div",{id:"seat_row-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),s.jsxs("div",{className:"col-md-2",children:[s.jsx("label",{htmlFor:"seat_column",className:"form-label",children:"Seat Column"}),s.jsx("input",{type:"number",min:0,max:10,className:"form-control text-center",id:"seat_column",defaultValue:this.state.table_column,onChange:t=>this.setState({table_column:t.target.value})}),s.jsx("div",{id:"seat_column-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),s.jsxs("div",{className:"col-md-2",children:[s.jsx("label",{htmlFor:"seat_row",className:"form-label",children:"Total Student"}),s.jsx("input",{type:"number",readOnly:!0,min:0,max:10,className:"form-control text-center",id:"seat_row",defaultValue:this.state.studentsListTemp.length}),s.jsx("div",{id:"seat_row-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),s.jsxs("div",{className:"col-md-4 pt-3",children:[s.jsx("button",{className:"btn btn-primary btn-lg",onClick:()=>{this.saveData()},children:"Update"}),this.state.existing_class.length>0&&this.state.seats.length==0?s.jsx("button",{className:"btn btn-info btn-lg ml-1",onClick:()=>{this.loadExistingData()},children:"Existing Assign"}):s.jsx(s.Fragment,{})]})]}),s.jsxs("div",{className:"float hands mt-2",children:[s.jsxs("div",{className:"center hands-70 float-start",children:[s.jsx("img",{className:"transform -scale-x-100",src:"/images/hands2.png"}),"LEFT"]}),s.jsxs("div",{className:"center hands-70 float-end",children:[s.jsx("img",{className:"",src:"/images/hands2.png"}),"RIGHT"]})]}),s.jsx("div",{className:"row",children:s.jsx("div",{className:"mx-auto mt-5",children:s.jsx("div",{className:"container text-center",children:Array.from({length:this.state.table_row}).map((t,e,a)=>{let d=e*this.state.table_column;return s.jsx("div",{className:"row align-items-center",children:Array.from({length:this.state.table_column}).map((l,n,i)=>{d++;let o=this.state.table_row*this.state.table_column-d;return s.jsx("div",{className:"col mt-3 mb-3",children:s.jsxs("center",{children:[s.jsxs("div",{className:"attendance_icons",children:[s.jsx("img",{src:"/images/student_chair.png",id:`col_${n}_row_${e}_chair`,className:"student_chair",alt:""}),this.state.seats.length>0&&this.state.seats.find(r=>r.seat_number==o+1)!=null?s.jsx("img",{src:"/adminlte/dist/assets/img/avatar.png",className:"attendance_prof_img rounded-circle shadow auto-margin-lr",alt:""}):null]}),this.state.seats.length>0&&this.state.seats.find(r=>r.seat_number==o+1)!=null?s.jsxs(s.Fragment,{children:[s.jsx("label",{id:`col_${n}_row_${e}_name`,className:"badge text-bg-success",children:this.state.seats.find(r=>r.seat_number==o+1).fullname}),s.jsx("br",{})]}):s.jsx(s.Fragment,{}),s.jsxs("label",{id:`col_${n}_row_${e}_count`,className:"badge text-bg-primary",children:["# ",o+1]}),s.jsxs("div",{children:[this.state.seats.length==0||this.state.seats.find(r=>r.seat_number===o+1)==null?s.jsx("button",{id:`bx_${o+1}`,className:"btn btn-xs btn-success",onClick:()=>{this.state.studentsListTemp.length>0?(this.setState({selectSeat:o+1}),$("#studentModel").modal("show")):c.fire({title:"No student added to this class",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Close",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})},children:s.jsx("i",{className:"bi bi-plus"})}):null,this.state.seats.length>0&&this.state.seats.find(r=>r.seat_number===o+1)!=null?s.jsx("button",{id:`bx_${o+1}`,className:"btn btn-xs btn-danger",onClick:()=>{this.setState({selectSeat:o+1},()=>{this.removeStudent(o+1)})},children:s.jsx("i",{className:"bi bi-x"})}):null]})]})},`seat_${e}_${n}`)})},`seat_${e}`)})})})})]})}),s.jsx("datalist",{id:"selectStudent",children:s.jsx(f,{of:this.state.studentsList,render:(t,e)=>s.jsx("option",{children:`${t.last_name}, ${t.first_name}`})})}),s.jsx("div",{className:"modal fade",tabIndex:"-1",role:"dialog",id:"studentModel","aria-hidden":"true","data-bs-backdrop":"static",children:s.jsx("div",{className:"modal-dialog",role:"document",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h5",{className:"modal-title fs-5",children:["Add Student ",this.state.selectSeat!=0?s.jsxs("i",{className:"fs-6",children:["(Selected Seat # ",this.state.selectSeat,")"]}):s.jsx(s.Fragment,{})," "]}),s.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),s.jsx("div",{className:"modal-body",children:s.jsx("div",{className:"card-body",children:s.jsx("div",{className:"row g-3",children:s.jsxs("div",{className:"col-md-12",children:[s.jsx("label",{htmlFor:"studentselection",className:"form-label",children:"Student"}),s.jsx("input",{type:"text",className:"form-control",list:"selectStudent",id:"studentselection",defaultValue:"",required:"",onChange:t=>{$("#studentselection-alert").removeAttr("class").addClass("invalid-feedback"),this.setState({studentselection:t.target.value})}}),s.jsx("div",{id:"studentselection-alert",className:"invalid-feedback",children:"Please select a valid state."})]})})})}),s.jsxs("div",{className:"modal-footer",children:[s.jsxs("button",{className:"btn btn-success float-right mr-1",onClick:()=>{this.addStudent()},children:[" ",s.jsx("i",{className:"bi bi-save"})," Add"]}),s.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"})]})]})})})]})})}}export{k as default};
