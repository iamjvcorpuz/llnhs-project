import{r as h,a as r,j as e,M as _}from"./app-MQ-yEurC.js";import{E as f}from"./EachMethod-DlQbtg5B.js";import{A as p,s as y,P as m}from"./commonFunctions-DLOGa6Ui.js";import"./sweetalert2.esm.all-DPJM2oV6.js";import{h as l}from"./moment-C5S46NFB.js";import{R as x}from"./ReactTable-CiiRreiS.js";import"./index-FTPeQx5Q.js";setInterval(async()=>{let a=l(new Date);$("#datetime").text("Today "+a.format("dddd, MMMM Do YYYY, h:mm:ss a"))},800);class T extends h.Component{constructor(a){super(a),this.state={userdata:{},requestimg:"/adminlte/dist/assets/img/avatar.png",timeCount:"00:00:00 AM",datenow:"00/00/000 Monday",profileImageBase64:"",lrn:"",idnumber:"",fullname:"",logger_type:"",logger_section:"",data:[],columns:[{Header:"Name",width:197,accessor:"fullname",className:"text-start"},{Header:"Time Logs",accessor:"timelogs",maxWidth:800}],time_logs_status:"",time_logs_status_message:"",attendance_data:[],attendance_data_temp:[],pagenationIndex:0,scanned_code:""},this.intervals=null,this.handleFocusableElements=!0,this.eventKeys=this.eventKeys.bind(this),this.queryAccounts=this.queryAccounts.bind(this),this.queryAttendanceLogs=this.queryAttendanceLogs.bind(this),this.insertLogs=this.insertLogs.bind(this),this.speak=this.speak.bind(this),this.AlertSound=p,this.timeoutScan=null}componentDidMount(){window.addEventListener("keydown",this.eventKeys),this.getAllTodaysTimeLogs()}paganationPosition(a){a<this.state.attendance_data_temp.length&&a>0?this.setState({pagenationIndex:a}):a==0&&this.setState({pagenationIndex:a})}async eventKeys(a,i){let t=this,s=a.key;try{if(t.timeoutScan!=null){t.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Please Try Again"});return}else t.setState({userdata:{},idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"",time_logs_status_message:""});if(s=="Enter"&&t.state.scanned_code!="Enter"&&t.state.scanned_code.trim()!=="")t.timeoutScan=setTimeout(()=>{clearTimeout(t.timeoutScan),t.timeoutScan=null},2e3),t.queryAccounts(t.state.scanned_code),t.setState({scanned_code:""});else{let n=t.state.scanned_code+s;s==="Enter"?t.setState({scanned_code_history:"",scanned_code:""}):t.setState({scanned_code_history:n,scanned_code:n})}}catch{}}getTimeLogs(a){let i=l(new Date).format("YYYY-MM-DD");r.post("/attendance/time/logs",{qrcode:a,date:i}).then(function(t){console.log(t),typeof t.status<"u"&&t.status=="200"&&(typeof t.data<"u"&&typeof t.data.data<"u"&&t.data.data,typeof t.data<"u"&&t.data.status=="success")})}getAllTodaysTimeLogs(){let a=this,i=l(new Date).format("YYYY-MM-DD");r.post("/attendance/time/today/all/timelogs",{date:i}).then(function(t){if(console.log(t),typeof t.status<"u"&&t.status=="200"){let s=typeof t.data<"u"&&typeof t.data.data<"u"?t.data.data:[];typeof t.data<"u"&&t.data.status=="success"&&a.setState({attendance_data:s.sort(y)},()=>{m(a.state.attendance_data,a.state.pagenationIndex,4,null).Content("",n=>{typeof n<"u"?a.setState({attendance_data_temp:n}):a.setState({attendance_data_temp:n})})})}})}queryAccounts(a){let i=this;r.post("/attendance/account/find",{code:a}).then(function(t){if(typeof t.status<"u"&&t.status=="200"){let s=typeof t.data<"u"&&typeof t.data.data<"u"?t.data.data:{};typeof t.data<"u"&&t.data.status=="success"?(console.log("aw",s),i.setState({userdata:s,_id:s.id,lrn:typeof s.lrn<"u"?s.lrn:s.qr_code,profileImageBase64:s.picture_base64,fullname:`${s.first_name} ${s.last_name}`.toLocaleUpperCase(),idnumber:s.id,logger_type:s.type,logger_section:typeof s.section<"u"?s.section:""},()=>{i.queryAttendanceLogs(a,s)})):typeof t.data<"u"&&t.data.status=="not_found"&&(i.AlertSound.denied(),i.alertMessages(),i.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Not Found"}))}else i.AlertSound.denied(),i.alertMessages(),i.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Sorry Please Try Again"})}).catch(function(t){console.log(t)}).finally(function(){})}queryAttendanceLogs(a,i){let t=this,s=l(new Date).format("YYYY-MM-DD");r.post("/attendance/time/logs",{qrcode:a,date:s}).then(function(n){if(console.log(n),typeof n.status<"u"&&n.status=="200"&&(typeof n.data<"u"&&typeof n.data.data<"u"&&n.data.data,typeof n.data<"u"&&n.data.status=="success")){let d="Time In: "+l(new Date).format("hh:mm A"),u=t.state.attendance_data.filter(c=>c._id==t.state._id),o="";u.length%2==0?(d="Time In: "+l(new Date).format("hh:mm A"),o="IN"):(d="Time Out: "+l(new Date).format("hh:mm A"),o="OUT"),t.insertLogs({code:a,date:s,time:l(new Date).format("hh:mm A"),mode:o},i,()=>{t.setState({attendance_data:[...t.state.attendance_data,{_id:t.state._id,profile_photo:t.state.profileImageBase64,fullname:t.state.fullname,nicname:"",timelogs:d,section:"Section 1",mode:o}]},()=>{t.AlertSound.speech(`${t.state.fullname}. successfuly. time ${o}`),m(t.state.attendance_data,t.state.pagenationIndex,4,null).Content("",c=>{typeof c<"u"?t.setState({attendance_data_temp:c}):t.setState({attendance_data_temp:c})})})})}})}insertLogs(a,i,t){let s=this;delete i.picture_base64,r.post("/attendance/time/new/entry",{logsdata:a,userdata:i}).then(function(n){if(typeof n.status<"u"&&n.status=="200"){let d=typeof n.data<"u"&&typeof n.data.data<"u"?n.data.data:{};typeof n.data<"u"&&n.data.status=="success"?(console.log("aw",d),s.getAllTodaysTimeLogs(),t()):typeof n.data<"u"&&n.data.status=="not_found"&&(s.AlertSound.denied(),s.alertMessages(),s.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Not Found"}),t())}else s.AlertSound.denied(),s.alertMessages(),s.setState({idnumber:"",fullname:"",logger_type:"",logger_section:"",time_logs_status:"bg-danger",time_logs_status_message:"Sorry Please Try Again"}),t()}).catch(function(n){console.log(n),t()}).finally(function(){})}alertMessages(){let a=this,i=5e3;this.intervals!=null&&(clearTimeout(this.intervals),this.intervals=null),this.intervals=setTimeout(()=>{a.setState({lrn:"",profileImageBase64:"",requestimg:"",fullname:"",idnumber:"",logger_type:"",logger_section:"",time_logs_status:"",time_logs_status_message:""},()=>{clearTimeout(this.intervals),this.intervals=null})},i)}speak(a){const i=new SpeechSynthesisUtterance(a),t=speechSynthesis.getVoices();i.voice=t[1],speechSynthesis.speak(i)}render(){return e.jsxs("div",{className:"noselect",children:[e.jsx(_,{title:"Attendance"}),e.jsx("nav",{className:"main-header navbar attendance-nav",children:e.jsxs("div",{className:"attendance-nav-container",children:[e.jsx("div",{className:"col-lg-1",children:e.jsx("center",{children:e.jsx("img",{src:"/images/ic_launcher.png",alt:"AdminLTE Logo",className:"img-circle",height:100,width:100})})}),e.jsxs("div",{className:"col-lg-9",children:[e.jsx("label",{className:"attendance-school-font",children:"Lebak Legislated National High School "}),e.jsx("p",{className:"h6",children:"Poblacion III Lebak, Sultan Kudarat, 9807 Philippines"})]}),e.jsx("div",{className:"col-lg-2",children:e.jsx("img",{src:"/images/bagongtae.png",alt:"AdminLTE Logo",className:"img-circle",width:220})})]})}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"log-user-photo",children:e.jsx("center",{children:e.jsx("img",{className:"attendance-login-profile logo_round shadow",src:this.state.profileImageBase64!=""?this.state.profileImageBase64:"/adminlte/dist/assets/img/avatar.png",ref:a=>this.photo_time_view_image=a,onError:a=>{this.photo_time_view_image.src="/images/adminlte/dist/assets/img/avatar.png"},alt:"Picture Error"})})}),e.jsxs("div",{className:"log-center-data",children:[e.jsx("br",{}),e.jsx("br",{}),e.jsx("br",{}),e.jsxs("div",{className:"header_time",children:[e.jsx("div",{className:"logger-name-small",children:this.state.logger_type=="Student"?this.state.idnumber!=""?`LRN : ${this.state.lrn}`:"":this.state.idnumber!=""?`ID : ${this.state.lrn}`:""}),e.jsx("hr",{}),e.jsx("div",{className:"logger-name",children:e.jsx("strong",{children:this.state.fullname!=""?this.state.fullname:""})}),e.jsx("hr",{}),e.jsx("div",{className:"logger-name-small",children:this.state.logger_type=="Student"?this.state.logger_section!=""?this.state.logger_section:"":null}),e.jsx("hr",{}),e.jsx("div",{className:"datetimeCount",id:"datetime",children:"-"}),e.jsx("hr",{}),e.jsx("div",{className:"logger-name-small-2",children:this.state.time_logs_status!=""?e.jsx("div",{className:`time-logs-status center text-white ${this.state.time_logs_status}`,children:e.jsx("label",{children:this.state.time_logs_status_message})}):null})]}),e.jsx("div",{className:"header_time",children:e.jsx(x,{className:"table table-bordered table-striped ",data:this.state.attendance_data,columns:this.state.columns,showHeader:!0,showPagenation:!0,defaultPageSize:8},"react-tables")}),e.jsxs("div",{className:"log-center-data-total-logs",children:["Total Logs: ",this.state.attendance_data.length]})]}),e.jsx("div",{className:"log-right-photo-list",children:e.jsx("div",{className:"view_list_right_side",children:e.jsx(f,{of:this.state.attendance_data_temp.length>0?this.state.attendance_data_temp[this.state.pagenationIndex]:[],render:(a,i)=>e.jsxs("div",{className:"image_list",children:[e.jsx("img",{className:"logo_round_mini_mobile",style:{height:"100px"},onError:t=>{t.target.error=null,t.target.src="/adminlte/dist/assets/img/avatar.png"},src:typeof a.profile_photo<"u"&&a.profile_photo!=""?a.profile_photo:"/adminlte/dist/assets/img/avatar.png",onClick:()=>{console.log("image call single click")},onDoubleClick:()=>{},alt:"profile picture"}),e.jsx("p",{className:"logo_round_mini_name mb-0",children:e.jsx("strong",{children:a.fullname})}),e.jsx("p",{className:`logo_round_mini_name log-right-photo-list-time badge ${a.mode=="IN"?"bg-success":"bg-danger"} mb-0`,children:a.timelogs})]},i)})})})]})]})}}export{T as default};
