import{r as u,j as e,U as f}from"./app-MQ-yEurC.js";import{E as m}from"./EachMethod-DlQbtg5B.js";import{S as t}from"./sweetalert2.esm.all-DPJM2oV6.js";import{D as h}from"./DashboardLayout-Q83-rxtQ.js";import{R as p}from"./ReactTable-CiiRreiS.js";import"./Dropdown-DtFVle0_.js";import"./transition-CQN9Mefa.js";import"./index-DzSybp8L.js";import"./index-FTPeQx5Q.js";class k extends u.Component{constructor(a){super(a),this.state={data:this.props.user_list,data_users:[],columns:[{id:"no",accessor:"index",Header:"No.",width:50,className:"center"},{id:"picture",Header:"Picture",accessor:"photo",className:"center",width:126,Cell:({row:s})=>e.jsx("img",{className:"",height:100,width:100,onError:n=>{n.target.src=s.original.sex=="Male"?"/adminlte/dist/assets/img/avatar.png":"/adminlte/dist/assets/img/avatar-f.jpeg"},alt:"Picture Error",src:s.original.photo!=null&&s.original.photo!=""?s.original.photo:s.original.sex=="Male"?"/adminlte/dist/assets/img/avatar.png":"/adminlte/dist/assets/img/avatar-f.jpeg"})},{id:"fullname",Header:"Fullname",width:800,accessor:"fullname"},{id:"type",Header:"User Type",width:100,accessor:"user_role",className:"center"},{id:"action",Header:"Action",width:200,accessor:"user_role",className:"center",Cell:({row:s})=>e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger btn-block btn-sm col-12 mb-1",onClick:()=>{this.deleteUsers(s.original.id)},children:[" ",e.jsx("i",{className:"bi bi-person-fill-x"})," Remove"]}),e.jsxs("button",{className:"btn btn-primary btn-block btn-sm col-12 mb-1",onClick:()=>{$("#resetPassword").modal("show"),$("#username").val(""),this.selectedAccounts(s.original)},children:[" ",e.jsx("i",{className:"bi bi-pen"})," Reset Password"]})]})}],selectedAccount:{}},this.selectedAccounts=this.selectedAccounts.bind(this),this.loadData=this.loadData.bind(this),this.saveNewAuthData=this.saveNewAuthData.bind(this),this.saveAuthData=this.saveAuthData.bind(this),console.log(this.props)}componentDidMount(){this.loadData(),this.getAllUsers()}getAllUsers(){let a=[];typeof this.props.data.teacher<"u"&&this.props.data.teacher.forEach(s=>{a.push({...s,user_type:"teacher"})}),typeof this.props.data.student<"u"&&this.props.data.student.forEach(s=>{a.push({...s,user_type:"student"})}),typeof this.props.data.guardians<"u"&&this.props.data.guardians.forEach(s=>{a.push({...s,user_type:"guardians"})}),this.setState({data_users:a})}selectedAccounts(a){console.log(a),$("#username").val(a.username),this.setState({selectedAccount:a})}loadData(){let a=this;axios.get("/user/accounts").then(function(s){if(console.log(s),typeof s.status<"u"&&s.status=="200"){let n=typeof s.data<"u"&&typeof s.data<"u"?s.data:{};Object.keys(n).length>0&&a.setState({data:n.data})}})}saveNewAuthData(){let a=this,s=$("#nusername").val(),n=$("#npassword").val();s!=""&&n!=""?t.fire({title:"If all fields are correct and please click to continue to save",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"warning",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(i=>{if(i.isConfirmed){t.fire({title:`Saving Records.
Please wait.`,html:'<i class="fa fa-times-circle-o"></i>&nbsp;&nbsp;Close',showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{t.showLoading()}});let d=`${a.state.selectedAccount.first_name} ${a.state.selectedAccount.last_name}`,l={...a.state.selectedAccount,id:a.state.selectedAccount.id,user_type:a.state.selectedAccount.user_type,user_role_id:a.state.selectedAccount.user_type,fullname:d,username:s,password:n};console.log(l),axios.post("/user/accounts/auth",l).then(async function(o){console.log(o),typeof o.status<"u"&&o.status=="201"?(typeof o.data<"u"&&typeof o.data<"u"?o.data:{}).status=="success"?t.fire({title:"Successfuly save!",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"success",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(function(c){c.isConfirmed&&(t.close(),$("#NewPassword").modal("hide"),$("#utype").val(""),$("#teacher").val(""),$("#nusername").val(""),$("#npassword").val(""),a.loadData(),a.setState({selectedAccount:{}}))}):t.fire({title:"Fail to save",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!1,closeOnClickOutside:!1,dangerMode:!0}):typeof o.status<"u"&&o.status=="200"?(typeof o.data<"u"&&typeof o.data<"u"?o.data:{}).status=="data_exist"&&t.fire({title:"Data Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}):typeof o.status<"u"&&o.status=="422"}).catch(function(o){console.log(o),t.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})}else i.isDismissed;return!1}):(s==""&&($("#nusername-alert").removeAttr("class"),$("#nusername-alert").html("Required Field"),$("#nusername-alert").addClass("d-block invalid-feedback")),n==""&&($("#npassword-alert").removeAttr("class"),$("#npassword-alert").html("Required Field"),$("#npassword-alert").addClass("d-block invalid-feedback")))}saveAuthData(){let a=this,s=$("#username").val(),n=$("#password").val();s!=""&&n!=""?t.fire({title:"If all fields are correct and please click to continue to save",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"warning",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(i=>{if(i.isConfirmed){t.fire({title:`Saving Records.
Please wait.`,html:'<i class="fa fa-times-circle-o"></i>&nbsp;&nbsp;Close',showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{t.showLoading()}});let d={...a.state.selectedAccount,update_username:s,update_password:n};console.log(d),axios.post("/user/update/auth",d).then(async function(l){if(console.log(l),typeof l.status<"u"&&l.status=="201")(typeof l.data<"u"&&typeof l.data<"u"?l.data:{}).status=="success"?t.fire({title:"Successfuly save!",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Continue",icon:"success",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(function(r){r.isConfirmed&&(t.close(),$("#resetPassword").modal("hide"),$("#username").val(""),$("#password").val(""),a.loadData())}):t.fire({title:"Fail to save",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!1,closeOnClickOutside:!1,dangerMode:!0});else if(typeof l.status<"u"&&l.status=="200"){let o=typeof l.data<"u"&&typeof l.data<"u"?l.data:{};(o.status="data_exist")&&t.fire({title:"Data Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})}else typeof l.status<"u"&&l.status=="422"}).catch(function(l){console.log(l),t.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})}else i.isDismissed;return!1}):(s==""&&($("#username-alert").removeAttr("class"),$("#username-alert").html("Required Field"),$("#username-alert").addClass("d-block invalid-feedback")),n==""&&($("#password-alert").removeAttr("class"),$("#password-alert").html("Required Field"),$("#password-alert").addClass("d-block invalid-feedback")))}deleteUsers(a){console.log("deleteUsers",a);let s=this;t.fire({title:"Are you sure to remove this data?",showCancelButton:!0,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Yes",confirmButtonColor:"red",icon:"question",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(n=>{n.isConfirmed?(t.fire({title:`Removing Records.
Please wait.`,showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1,didOpen:()=>{t.showLoading()}}),axios.delete("/user/accounts",{data:{id:a}}).then(function(i){typeof i.status<"u"&&i.status=="201"?(typeof i.data<"u"&&typeof i.data<"u"?i.data:{}).status=="success"?(s.loadData(),t.fire({title:"Successfuly remove!",showCancelButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonText:"Ok",icon:"success",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0}).then(function(l){l.isConfirmed&&t.close()})):t.fire({title:"Fail to remove",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!1,closeOnClickOutside:!1,dangerMode:!0}):typeof i.status<"u"&&i.status=="200"&&(typeof i.data<"u"&&typeof i.data<"u"?i.data:{}).status=="data_not_exist"&&t.fire({title:"Data Not Exist",cancelButtonText:"Ok",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})}).catch(function(i){console.log(i),t.fire({title:"Server Error",showCancelButton:!0,showConfirmButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,cancelButtonText:"Ok",confirmButtonText:"Continue",confirmButtonColor:"#DD6B55",icon:"error",showLoaderOnConfirm:!0,closeOnClickOutside:!1,dangerMode:!0})})):t.close()})}render(){return e.jsxs(h,{title:"User",user:this.props.auth.user,children:[e.jsx("div",{className:"app-content-header",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-sm-6",children:e.jsxs("h3",{className:"mb-0",children:[e.jsx("i",{className:"nav-icon bi bi-person-gear"})," Users Accounts"]})}),e.jsx("div",{className:"col-sm-6",children:e.jsxs("ol",{className:"breadcrumb float-sm-end",children:[e.jsxs("li",{className:"breadcrumb-item",children:[e.jsx("i",{className:"bi bi-speedometer mr-2"}),e.jsx(f,{href:"/admin/dashboard",children:"Dashboard"})]}),e.jsx("li",{className:"breadcrumb-item active","aria-current":"page",children:"Users"})]})})]})})}),e.jsx("div",{className:"app-content",children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-lg-12",children:e.jsxs("div",{className:"card mb-4",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("h3",{className:"card-title  mt-2",children:[" ",e.jsx("i",{className:"bi bi-person"})," Users List"]}),e.jsxs("button",{className:"btn btn-primary float-right mr-1",onClick:()=>{$("#NewPassword").modal("show")},children:[" ",e.jsx("i",{className:"bi bi-person-plus-fill"})," Add"]})]}),e.jsx("div",{className:"card-body",children:e.jsx(p,{className:"table table-bordered table-striped ",data:this.state.data,columns:this.state.columns},"react-tables")})]})})})})}),e.jsx("div",{className:"modal fade",tabIndex:"-1",role:"dialog",id:"resetPassword","aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title fs-5",children:"Reset Password"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"Username"}),e.jsx("input",{type:"text",className:"form-control",id:"username",defaultValue:"",required:"",onChange:a=>{}}),e.jsx("div",{id:"username-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"Password"}),e.jsx("input",{type:"password",className:"form-control",id:"password",defaultValue:"",required:"",onChange:a=>{}}),e.jsx("div",{id:"password-alert",className:"invalid-feedback",children:"Please select a valid state."})]})]})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs("button",{className:"btn btn-success float-right mr-1",onClick:()=>{this.saveAuthData()},children:[" ",e.jsx("i",{className:"bi bi-save"})," Save"]}),e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"})]})]})})}),e.jsx("div",{className:"modal fade",tabIndex:"-1",role:"dialog",id:"NewPassword","aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title fs-5",children:"Set Password"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"teacher",className:"form-label",children:"User"}),e.jsx("input",{type:"text",className:"form-control",list:"selectedUser",id:"teacher",defaultValue:"",required:"",onChange:a=>{$("#teacher-alert").removeAttr("class").addClass("invalid-feedback");let s=this.state.data_users.find(n=>`${n.last_name}, ${n.first_name}`==a.target.value);s!=null&&typeof s.user_type<"u"?($("#utype").val(s.user_type.toUpperCase()),this.setState({selectedAccount:s})):a.target.value==""&&($("#utype").val(""),this.setState({selectedAccount:{}}))}}),e.jsx("div",{id:"teacher-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"Type"}),e.jsx("input",{type:"text",className:"form-control",id:"utype",defaultValue:"",required:"",onChange:a=>{}}),e.jsx("div",{id:"type-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"Username"}),e.jsx("input",{type:"text",className:"form-control",id:"nusername",defaultValue:"",required:"",onChange:a=>{}}),e.jsx("div",{id:"nusername-alert",className:"invalid-feedback",children:"Please select a valid state."})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"Password"}),e.jsx("input",{type:"password",className:"form-control",id:"npassword",defaultValue:"",required:"",onChange:a=>{}}),e.jsx("div",{id:"npassword-alert",className:"invalid-feedback",children:"Please select a valid state."})]})]})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs("button",{className:"btn btn-success float-right mr-1",onClick:()=>{this.saveNewAuthData()},children:[" ",e.jsx("i",{className:"bi bi-save"})," Save"]}),e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"})]})]})})}),e.jsx("datalist",{id:"selectedUser",children:e.jsx(m,{of:this.state.data_users,render:(a,s)=>e.jsx("option",{value:`${a.last_name}, ${a.first_name}`,children:`${a.user_type}`})})})]})}}export{k as default};
